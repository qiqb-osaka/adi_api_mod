commands = [
  ["00", "6612"],
  ["00", "6610"],
  ["4E", "0001"],
  ["4D", "0000"],
  ["4C", "000C"],
  ["4B", "0840"],
  ["4A", "F000"],
  ["49", "003F"],
  ["48", "001F"],
  ["47", "008D"], # R71 [7:5]SYSREF_DIV_PRE=4='Divided by 4', [3]SYSREF_EN=1, [2]SYSREF_REPEAT=1
  ["46", "C350"],
  ["45", "0000"],
  ["44", "03E8"],
  ["43", "0000"],
  ["42", "01F4"],
  ["41", "0000"],
  ["40", "1388"],
  ["3F", "0000"],
  ["3E", "0322"],
  ["3D", "00A8"],
  ["3C", "03E8"],
  ["3B", "0001"],
  ["3A", "0401"], # R58 [15]IGNORE=0, [14]HYST=0, [13:12]INPIN_LVL=0=Vin/4, [11:9]FMT=2='sysrefreq=LVDS'
  ["39", "0020"],
  ["38", "0000"],
  ["37", "0000"],
  ["36", "0000"],
  ["35", "0000"],
  ["34", "0820"],
  ["33", "0080"],
  ["32", "0000"],
  ["31", "4180"],
  ["30", "0300"],
  ["2F", "0300"],
  ["2E", "07FE"], # R46 [1:0] OUTB_MUX=2
  ["2D", "C8DF"], # R45 [5:0] OUTB_PWR=1F
  ["2C", "3220"], # R44
  ["2B", "0000"],
  ["2A", "0000"],
  ["29", "0000"],
  ["28", "0000"],
  ["27", "0001"],
  ["26", "0000"],
  ["25", "0204"],
  ["24", "0078"],
  ["23", "0004"],
  ["22", "0000"],
  ["21", "1E21"],
  ["20", "0393"],
  ["1F", "43EC"],
  ["1E", "318C"],
  ["1D", "318C"],
  ["1C", "0488"],
  ["1B", "0002"],
  ["1A", "0DB0"],
  ["19", "0C2B"],
  ["18", "071A"],
  ["17", "007C"],
  ["16", "0001"],
  ["15", "0401"],
  ["14", "C848"],
  ["13", "27B7"],
  ["12", "0064"],
  ["11", "00FA"],
  ["10", "0080"],
  ["0F", "064F"],
  ["0E", "1E10"],
  ["0D", "4000"],
  ["0C", "5001"],
  ["0B", "0018"],
  ["0A", "10D8"],
  ["09", "0604"],
  ["08", "2000"],
  ["07", "00B2"],
  ["06", "C802"],
  ["05", "00C8"],
  ["04", "1B43"],
  ["03", "0642"],
  ["02", "0500"],
  ["01", "080B"],
  ["00", "6618"]
]

10.times{|i|
  commands.each{|cmd|
    system("TARGET_ADDR=10.5.0.1 ./udpsendrecv lmx2594 w #{i} #{cmd[0]} #{cmd[1]}")
    system("TARGET_ADDR=10.5.0.1 ./udpsendrecv lmx2594 w #{i} #{cmd[0]} #{cmd[1]}")
    str = `TARGET_ADDR=10.5.0.1 ./udpsendrecv lmx2594 r #{i} #{cmd[0]} 0`
    /return value: (\w+)/ =~ str
    ret = $1[4,7]
    if ret.upcase != cmd[1].upcase
      puts("ERROR: expected #{cmd[1].upcase}, get #{ret.upcase}")
    end
  }
}
